<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Pracowni Protetycznej v2.1</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif; background: #f3f4f6; color: #1f2937; }
        .nav { background: linear-gradient(135deg, #1e3a8a 0%, #3730a3 100%); color: white; padding: 1.5rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 100; }
        .nav-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; flex-wrap: wrap; gap: 1rem; }
        .nav-buttons { display: flex; gap: 0.5rem; }
        .nav-btn { padding: 0.5rem 1rem; background: rgba(255,255,255,0.2); border: none; color: white; cursor: pointer; border-radius: 0.5rem; font-size: 0.875rem; transition: all 0.2s; }
        .nav-btn:hover { background: rgba(255,255,255,0.3); }
        .nav-tabs { display: flex; gap: 0.5rem; flex-wrap: wrap; }
        .nav-tab { padding: 0.6rem 1rem; background: transparent; border: none; color: white; cursor: pointer; border-radius: 0.5rem; font-size: 0.9rem; transition: all 0.2s; }
        .nav-tab.active { background: rgba(255,255,255,0.25); font-weight: 600; box-shadow: inset 0 2px 4px rgba(0,0,0,0.1); }
        .main { padding: 2rem; max-width: 1400px; margin: 0 auto; min-height: 80vh; }
        .card { background: white; border-radius: 0.75rem; padding: 1.5rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1); margin-bottom: 1.5rem; }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem; }
        .stat-card { padding: 1.5rem; border-radius: 0.75rem; border: 1px solid #e5e7eb; }
        .stat-value { font-size: 2rem; font-weight: 700; margin-top: 0.5rem; }
        .btn { padding: 0.75rem 1.5rem; background: #2563eb; color: white; border: none; border-radius: 0.5rem; cursor: pointer; font-weight: 500; display: inline-flex; align-items: center; gap: 0.5rem; }
        .btn-red { background: #dc2626; }
        .btn-green { background: #16a34a; }
        .btn-sm { padding: 0.4rem 0.8rem; font-size: 0.85rem; }
        .form-group { margin-bottom: 1rem; }
        .form-label { display: block; font-size: 0.875rem; font-weight: 600; margin-bottom: 0.4rem; }
        .input, .select, .textarea { width: 100%; padding: 0.6rem; border: 1px solid #d1d5db; border-radius: 0.4rem; font-size: 1rem; }
        .list-item { border: 1px solid #e5e7eb; padding: 1rem; border-radius: 0.5rem; margin-bottom: 0.75rem; display: flex; justify-content: space-between; align-items: center; }
        .badge { padding: 0.25rem 0.6rem; border-radius: 99px; font-size: 0.75rem; font-weight: 600; }
        .badge-blue { background: #dbeafe; color: #1e40af; }
        .badge-green { background: #d1fae5; color: #065f46; }
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 1000; }
        .modal { background: white; padding: 2rem; border-radius: 1rem; width: 90%; max-width: 600px; max-height: 90vh; overflow-y: auto; }
        .toast { position: fixed; top: 1rem; right: 1rem; padding: 1rem; border-radius: 0.5rem; color: white; z-index: 1100; animation: slideIn 0.3s; }
        .toast.success { background: #10b981; }
        @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }
        .overdue { border-left: 5px solid #dc2626 !important; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script>
        const { useState, useEffect, createElement: e } = React;

        function DentalLabSystem() {
            const [activeTab, setActiveTab] = useState('dashboard');
            const [orders, setOrders] = useState([]);
            const [doctors, setDoctors] = useState([]);
            const [prosthetics, setProsthetics] = useState([]);
            const [employees, setEmployees] = useState([]);
            const [suppliers, setSuppliers] = useState([]);
            const [invoices, setInvoices] = useState([]);
            const [declarations, setDeclarations] = useState([]);
            const [showModal, setShowModal] = useState(false);
            const [modalType, setModalType] = useState('');
            const [editItem, setEditItem] = useState(null);
            const [searchTerm, setSearchTerm] = useState('');
            const [notification, setNotification] = useState(null);
            const [showConfirmDelete, setShowConfirmDelete] = useState(null);

            useEffect(() => {
                const load = (key) => JSON.parse(localStorage.getItem(key) || '[]');
                setOrders(load('orders'));
                setDoctors(load('doctors'));
                setEmployees(load('employees'));
                setSuppliers(load('suppliers'));
                setInvoices(load('invoices'));
                setDeclarations(load('declarations'));
                
                const savedP = load('prosthetics');
                if (savedP.length > 0) setProsthetics(savedP);
                else {
                    const def = [{ id: 1, name: 'Korona porcelanowa', gmlcCode: 'GMLC-01', minDays: 5, price: 500, stages: ['Odlew', 'Porcelana'] }];
                    setProsthetics(def);
                    localStorage.setItem('prosthetics', JSON.stringify(def));
                }
            }, []);

            const notify = (msg) => {
                setNotification(msg);
                setTimeout(() => setNotification(null), 3000);
            };

            const save = (key, data, setter) => {
                localStorage.setItem(key, JSON.stringify(data));
                setter(data);
            };

            const handleDelete = () => {
                const { type, id } = showConfirmDelete;
                if (type === 'order') {
                    const updated = orders.filter(o => o.id !== id);
                    save('orders', updated, setOrders);
                } else if (type === 'doctor') {
                    if (orders.some(o => Number(o.doctorId) === id)) return notify('BÅ‚Ä…d: Lekarz ma przypisane zlecenia!');
                    save('doctors', doctors.filter(d => d.id !== id), setDoctors);
                } else if (type === 'prosthetic') {
                    if (orders.some(o => Number(o.prostheticId) === id)) return notify('BÅ‚Ä…d: UzupeÅ‚nienie jest w uÅ¼yciu!');
                    save('prosthetics', prosthetics.filter(p => p.id !== id), setProsthetics);
                } else if (type === 'employee') {
                    save('employees', employees.filter(emp => emp.id !== id), setEmployees);
                } else if (type === 'supplier') {
                    save('suppliers', suppliers.filter(s => s.id !== id), setSuppliers);
                }
                setShowConfirmDelete(null);
                notify('UsuniÄ™to pomyÅ›lnie');
            };

            const renderDashboard = () => {
                const revenue = invoices.reduce((sum, inv) => sum + (inv.amount || 0), 0);
                return e('div', null,
                    e('div', { className: 'stats' },
                        e('div', { className: 'stat-card' }, e('div', null, 'Aktywne zlecenia'), e('div', { className: 'stat-value' }, orders.filter(o => o.status !== 'ZakoÅ„czone').length)),
                        e('div', { className: 'stat-card' }, e('div', null, 'Wystawione faktury'), e('div', { className: 'stat-value' }, invoices.length)),
                        e('div', { className: 'stat-card' }, e('div', null, 'Suma przychodÃ³w'), e('div', { className: 'stat-value', style: {color: '#166534'} }, revenue.toFixed(2) + ' zÅ‚'))
                    ),
                    e('div', { className: 'card' }, e('h2', null, 'Witaj w systemie'), e('p', null, 'Wybierz zakÅ‚adkÄ™ z menu powyÅ¼ej, aby zarzÄ…dzaÄ‡ pracowniÄ….'))
                );
            };

            const renderSimpleList = (items, type, title) => {
                return e('div', { className: 'card' },
                    e('div', { style: { display: 'flex', justifyContent: 'space-between', marginBottom: '1rem' } },
                        e('h2', null, title),
                        e('button', { className: 'btn btn-sm', onClick: () => { setModalType(type); setEditItem(null); setShowModal(true); } }, 'âž• Dodaj')
                    ),
                    items.map(item => e('div', { key: item.id, className: 'list-item' },
                        e('div', null,
                            e('strong', null, item.name),
                            e('div', { style: { fontSize: '0.85rem', color: '#6b7280' } }, 
                                type === 'prosthetic' ? `Kod: ${item.gmlcCode} | Cena: ${item.price} zÅ‚` : 
                                type === 'doctor' ? `Spec: ${item.specialty || 'Brak'}` : `Rola: ${item.position || item.service || 'Brak'}`
                            )
                        ),
                        e('div', null,
                            e('button', { className: 'btn btn-sm', style: {marginRight: '0.5rem'}, onClick: () => { setEditItem(item); setModalType(type); setShowModal(true); } }, 'âœï¸'),
                            e('button', { className: 'btn btn-sm btn-red', onClick: () => setShowConfirmDelete({ type, id: item.id }) }, 'ðŸ—‘ï¸')
                        )
                    ))
                );
            };

            const renderOrders = () => {
                return e('div', null,
                    e('div', { className: 'card', style: {display: 'flex', justifyContent: 'space-between', alignItems: 'center'} },
                        e('h2', null, 'ðŸ“‹ Zlecenia'),
                        e('button', { className: 'btn', onClick: () => { setModalType('order'); setEditItem(null); setShowModal(true); } }, 'Nowe zlecenie')
                    ),
                    orders.map(order => {
                        const dr = doctors.find(d => d.id === Number(order.doctorId));
                        const pr = prosthetics.find(p => p.id === Number(order.prostheticId));
                        const isOverdue = new Date(order.deadline) < new Date() && order.status !== 'ZakoÅ„czone';
                        
                        return e('div', { key: order.id, className: `card ${isOverdue ? 'overdue' : ''}` },
                            e('div', { style: { display: 'flex', justifyContent: 'space-between' } },
                                e('div', null,
                                    e('h3', null, pr?.name || 'Nieznane uzupeÅ‚nienie'),
                                    e('p', null, `Pacjent: ${order.patientCode} | Lekarz: ${dr?.name || 'Nieprzypisany'}`),
                                    e('p', { style: {fontSize: '0.85rem'} }, `Termin: ${order.deadline} | ZÄ™by: ${order.teethNumbers}`)
                                ),
                                e('div', { style: { textAlign: 'right' } },
                                    e('div', { className: 'badge badge-blue', style: {marginBottom: '0.5rem', display: 'inline-block'} }, order.status),
                                    e('div', null,
                                        e('button', { className: 'btn btn-sm btn-red', onClick: () => setShowConfirmDelete({type: 'order', id: order.id}) }, 'ðŸ—‘ï¸')
                                    )
                                )
                            )
                        );
                    })
                );
            };

            return e('div', null,
                notification && e('div', { className: 'toast success' }, notification),
                
                e('nav', { className: 'nav' },
                    e('div', { className: 'nav-header' }, e('h1', null, 'ðŸ¦· DentalLab Pro')),
                    e('div', { className: 'nav-tabs' },
                        ['dashboard', 'orders', 'doctors', 'prosthetics', 'employees', 'suppliers'].map(tab => 
                            e('button', { 
                                key: tab, 
                                className: `nav-tab ${activeTab === tab ? 'active' : ''}`, 
                                onClick: () => setActiveTab(tab) 
                            }, tab.charAt(0).toUpperCase() + tab.slice(1))
                        )
                    )
                ),

                e('main', { className: 'main' },
                    activeTab === 'dashboard' && renderDashboard(),
                    activeTab === 'orders' && renderOrders(),
                    activeTab === 'doctors' && renderSimpleList(doctors, 'doctor', 'Lekarze'),
                    activeTab === 'prosthetics' && renderSimpleList(prosthetics, 'prosthetic', 'UzupeÅ‚nienia'),
                    activeTab === 'employees' && renderSimpleList(employees, 'employee', 'Pracownicy'),
                    activeTab === 'suppliers' && renderSimpleList(suppliers, 'supplier', 'Dostawcy')
                ),

                showModal && e('div', { className: 'modal-overlay' },
                    e('div', { className: 'modal' },
                        e('h2', null, editItem ? 'Edytuj' : 'Dodaj'),
                        e('div', { style: { marginTop: '1rem' } },
                            modalType === 'order' ? e('div', null,
                                e('label', { className: 'form-label' }, 'Kod Pacjenta'),
                                e('input', { className: 'input', defaultValue: editItem?.patientCode, id: 'f_pc' }),
                                e('label', { className: 'form-label' }, 'Lekarz'),
                                e('select', { className: 'select', id: 'f_dr' }, doctors.map(d => e('option', { value: d.id }, d.name))),
                                e('label', { className: 'form-label' }, 'UzupeÅ‚nienie'),
                                e('select', { className: 'select', id: 'f_pr' }, prosthetics.map(p => e('option', { value: p.id }, p.name))),
                                e('label', { className: 'form-label' }, 'Termin'),
                                e('input', { type: 'date', className: 'input', id: 'f_dl' }),
                                e('label', { className: 'form-label' }, 'ZÄ™by'),
                                e('input', { className: 'input', id: 'f_tn', placeholder: 'np. 12, 11' })
                            ) : e('div', null,
                                e('label', { className: 'form-label' }, 'Nazwa/ImiÄ™ i Nazwisko'),
                                e('input', { className: 'input', defaultValue: editItem?.name, id: 'f_name' }),
                                modalType === 'prosthetic' && e('div', null,
                                    e('label', { className: 'form-label' }, 'Cena'),
                                    e('input', { type: 'number', className: 'input', id: 'f_price' }),
                                    e('label', { className: 'form-label' }, 'Kod GMLC'),
                                    e('input', { className: 'input', id: 'f_gmlc' })
                                )
                            )
                        ),
                        e('div', { style: { marginTop: '1.5rem', display: 'flex', gap: '0.5rem' } },
                            e('button', { className: 'btn', onClick: () => {
                                const newData = { id: editItem?.id || Date.now() };
                                if (modalType === 'order') {
                                    newData.patientCode = document.getElementById('f_pc').value;
                                    newData.doctorId = document.getElementById('f_dr').value;
                                    newData.prostheticId = document.getElementById('f_pr').value;
                                    newData.deadline = document.getElementById('f_dl').value;
                                    newData.teethNumbers = document.getElementById('f_tn').value;
                                    newData.status = 'Nowe';
                                    const updated = editItem ? orders.map(o => o.id === editItem.id ? newData : o) : [...orders, newData];
                                    save('orders', updated, setOrders);
                                } else {
                                    newData.name = document.getElementById('f_name').value;
                                    if(modalType === 'prosthetic') {
                                        newData.price = Number(document.getElementById('f_price').value);
                                        newData.gmlcCode = document.getElementById('f_gmlc').value;
                                    }
                                    const list = modalType === 'doctor' ? doctors : modalType === 'prosthetic' ? prosthetics : modalType === 'employee' ? employees : suppliers;
                                    const setter = modalType === 'doctor' ? setDoctors : modalType === 'prosthetic' ? setProsthetics : modalType === 'employee' ? setEmployees : setSuppliers;
                                    const updated = editItem ? list.map(i => i.id === editItem.id ? newData : i) : [...list, newData];
                                    save(modalType + 's', updated, setter);
                                }
                                setShowModal(false);
                                notify('Zapisano pomyÅ›lnie');
                            }}, 'Zapisz'),
                            e('button', { className: 'btn btn-red', onClick: () => setShowModal(false) }, 'Anuluj')
                        )
                    )
                ),

                showConfirmDelete && e('div', { className: 'modal-overlay' },
                    e('div', { className: 'modal', style: {maxWidth: '400px'} },
                        e('h2', null, 'PotwierdÅº usuniÄ™cie'),
                        e('p', null, 'Czy na pewno chcesz usunÄ…Ä‡ ten element?'),
                        e('div', { style: {marginTop: '1.5rem', display: 'flex', gap: '0.5rem'} },
                            e('button', { className: 'btn btn-red', onClick: handleDelete }, 'UsuÅ„'),
                            e('button', { className: 'btn', onClick: () => setShowConfirmDelete(null) }, 'Anuluj')
                        )
                    )
                )
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(e(DentalLabSystem));
    </script>
</body>
</html>
